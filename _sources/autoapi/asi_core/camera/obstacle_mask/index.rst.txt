asi_core.camera.obstacle_mask
=============================

.. py:module:: asi_core.camera.obstacle_mask

.. autoapi-nested-parse::

   This module provides functions to automatically generate camera masks for all-sky imagers.



Functions
---------

.. autoapisummary::

   asi_core.camera.obstacle_mask.save_mask
   asi_core.camera.obstacle_mask.adjust_gamma
   asi_core.camera.obstacle_mask.compute_mask
   asi_core.camera.obstacle_mask.aggregate_images
   asi_core.camera.obstacle_mask.create_mask
   asi_core.camera.obstacle_mask.detect_mask_cv


Module Contents
---------------

.. py:function:: save_mask(mask, mask_dir, mask_name)

   Save a mask as both a `.npy` and a legacy `.mat` file.

   :param mask: The mask array to be saved.
   :type mask: numpy.ndarray
   :param mask_dir: The directory where the mask files will be saved.
   :type mask_dir: pathlib.Path
   :param mask_dir: The name of the mask files.
   :type mask_dir: string
   :returns: None


.. py:function:: adjust_gamma(image, gamma=1.0)

   Apply gamma correction to an image by building a lookup table mapping the pixel values [0, 255] to their adjusted
   gamma values


.. py:function:: compute_mask(avg_img)

   Create an image mask based on the input image. Input image should be a daily/longterm average image based
   on equalized histogram to enhance contrast


.. py:function:: aggregate_images(img_list, gray_scale=False, equalization=False, blur=False)

   Process a list of images by applying optional grayscale conversion, histogram equalization,
   and blurring. Computes the average and standard deviation of the processed images.

   :param img_list: List of input images as NumPy arrays.
   :type img_list: list of numpy.ndarray
   :param gray_scale: Whether to convert images to grayscale (default is False).
   :type gray_scale: bool, optional
   :param equalization: Whether to apply histogram equalization to enhance contrast (default is False).
   :type equalization: bool, optional
   :param blur: Whether to apply a blurring filter to reduce noise (default is False).
   :type blur: bool, optional
   :return: A dictionary containing processed images, their average, and standard deviation.
   :rtype: dict


.. py:function:: create_mask(img_files, num_images=-1)

   Create a mask of static objects from a set of image files.

   This function aggregates a specified number of images from the provided list,
   computes an average image with optional grayscale conversion, histogram
   equalization, and blurring, and then generates a mask highlighting static
   objects present across the images.

   :param img_files: A list of image file paths to be used for mask generation.
   :type img_files: list[str] or list[pathlib.Path]
   :param num_images: The number of images to use for aggregation. If -1, use all provided images.
   :type num_images: int, optional
   :returns: The generated mask based on static objects detected in the aggregated image.
   :rtype: numpy.ndarray
   :raises ValueError: If `img_files` is empty or if `num_images` is 0.


.. py:function:: detect_mask_cv(img, max_intensity, gaussian_kernel, adaptive_thres_block_size, adaptive_thres_mean_offset, erode_dilate_kernel, margin_horizon)

   Applies computer vision methods to automatically detect a mask of obstacles obscuring the sky in the ASI image.

   :param img: Image to be used for mask generation.
   :param mask_intesity: 
   :param gaussian_kernel: 
   :param adaptive_thres_block_size: 
   :param adaptive_thres_mean_offset: 
   :param erode_dilate_kernel: 
   :param margin_horizon: 
   :return: automatically detected mask, dtype boolean, shape of greyscaled RGB input image


